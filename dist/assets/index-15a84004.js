import{Q as ha,w as u,R as Oe,M as re,x as va,y as ga,E as xa,z as be,r as D,D as fa,P as ya,J as ja,K as ba,S as _a,c as Q,j as a,L as O,u as S,q as x,a as y,e as ke,i as ce,T as ae,f as _e,t as m,n as h,I as Sa,p as $e,U as wa,B as p,d as Ee,V as Na,W as Ca,b as oe,v as Pa,h as Ma}from"./index-12f53e8e.js";import{A as Ia}from"./AgencySelect-cc097724.js";import{T as Oa}from"./Table-633ed10d.js";import{I as ka}from"./IconEye-b128259a.js";import{I as $a}from"./IconTrash-a0adb7cb.js";import{I as Ea,u as Da,L as Ra}from"./LoadingScreen-22d0c5a3.js";import{T as De}from"./TextEditor-f6344a82.js";import{T as I}from"./TextInput-51bbb2c9.js";import{I as Va}from"./IconSearch-bc63afe7.js";import{C as _,S as de}from"./Select-71aebe02.js";import{I as Se}from"./IconCategory-7f581bda.js";import{I as za}from"./IconPaperclip-66708d8f.js";import{c as Aa}from"./clamp-73f6bef2.js";import{F as Re}from"./FileDropzone-edfd9d09.js";import{u as me}from"./use-form-74445202.js";import{D as Ba}from"./DateInput-0b0ff31b.js";import{I as Fa}from"./IconArrowLeft-88abc8bc.js";import{I as La}from"./ItemSelect-aace8201.js";import{R as se}from"./Radio-7af4a5cf.js";import"./get-base-value-c9a8a49c.js";import"./ScrollArea-9d3afb8e.js";import"./LoadingOverlay-6e1fe5d5.js";import"./IconPhoto-ff774c4c.js";const[Ta,Ve]=ha("Rating was not found in tree");var Ka={root:"m-f8d312f2",symbolGroup:"m-61734bb7",starSymbol:"m-5662a89a",input:"m-211007ba",label:"m-21342ee4",symbolBody:"m-fae05d6a"};const ze=Ka;var Ya=Object.defineProperty,T=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,we=(e,s,t)=>s in e?Ya(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,Ne=(e,s)=>{for(var t in s||(s={}))Ae.call(s,t)&&we(e,t,s[t]);if(T)for(var t of T(s))Be.call(s,t)&&we(e,t,s[t]);return e},Qa=(e,s)=>{var t={};for(var n in e)Ae.call(e,n)&&s.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&T)for(var n of T(e))s.indexOf(n)<0&&Be.call(e,n)&&(t[n]=e[n]);return t};function Fe(e){const s=e,{width:t,height:n,style:l}=s,r=Qa(s,["width","height","style"]);return u.createElement("svg",Ne({viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:Ne({width:t,height:n},l)},r),u.createElement("path",{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"}))}Fe.displayName="@mantine/core/StarIcon";var Ha=Object.defineProperty,qa=Object.defineProperties,Ga=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ua=Object.prototype.propertyIsEnumerable,Pe=(e,s,t)=>s in e?Ha(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,Wa=(e,s)=>{for(var t in s||(s={}))Ja.call(s,t)&&Pe(e,t,s[t]);if(Ce)for(var t of Ce(s))Ua.call(s,t)&&Pe(e,t,s[t]);return e},Xa=(e,s)=>qa(e,Ga(s));function ie({type:e}){const s=Ve();return u.createElement(Fe,Xa(Wa({},s.getStyles("starSymbol")),{"data-filled":e==="full"||void 0}))}ie.displayName="@mantine/core/StarSymbol";var Za=Object.defineProperty,es=Object.defineProperties,as=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,Le=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,Me=(e,s,t)=>s in e?Za(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,L=(e,s)=>{for(var t in s||(s={}))Le.call(s,t)&&Me(e,t,s[t]);if(K)for(var t of K(s))Te.call(s,t)&&Me(e,t,s[t]);return e},te=(e,s)=>es(e,as(s)),ss=(e,s)=>{var t={};for(var n in e)Le.call(e,n)&&s.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&K)for(var n of K(e))s.indexOf(n)<0&&Te.call(e,n)&&(t[n]=e[n]);return t};function Ke(e){var s=e,{size:t,getSymbolLabel:n,emptyIcon:l,fullIcon:r,full:o,active:d,value:c,readOnly:f,fractionValue:j,color:R,id:w,onBlur:H,onChange:V,onInputChange:q,style:pe}=s,z=ss(s,["size","getSymbolLabel","emptyIcon","fullIcon","full","active","value","readOnly","fractionValue","color","id","onBlur","onChange","onInputChange","style"]),g;const N=Ve(),C=typeof r=="function"?r(c):r,A=typeof l=="function"?l(c):l,{dir:B}=Oe();return u.createElement(u.Fragment,null,!f&&u.createElement("input",L(te(L({},N.getStyles("input")),{onKeyDown:F=>F.key===" "&&V(c),id:w,type:"radio","data-active":d||void 0,"aria-label":n==null?void 0:n(c),value:c,onBlur:H,onChange:q}),z)),u.createElement(re,te(L({component:f?"div":"label"},N.getStyles("label")),{"data-read-only":f||void 0,htmlFor:w,onClick:()=>V(c),__vars:{"--rating-item-z-index":(g=j===1?void 0:d?2:0)==null?void 0:g.toString()}}),u.createElement(re,te(L({},N.getStyles("symbolBody")),{__vars:{"--rating-symbol-clip-path":j===1?void 0:B==="ltr"?`inset(0 ${d?100-j*100:100}% 0 0)`:`inset(0 0 0 ${d?100-j*100:100}% )`}}),o?C||u.createElement(ie,{type:"full"}):A||u.createElement(ie,{type:"empty"}))))}Ke.displayName="@mantine/core/RatingItem";var ts=Object.defineProperty,ns=Object.defineProperties,ls=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,Ye=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,Ie=(e,s,t)=>s in e?ts(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,ne=(e,s)=>{for(var t in s||(s={}))Ye.call(s,t)&&Ie(e,t,s[t]);if(Y)for(var t of Y(s))Qe.call(s,t)&&Ie(e,t,s[t]);return e},rs=(e,s)=>ns(e,ls(s)),os=(e,s)=>{var t={};for(var n in e)Ye.call(e,n)&&s.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&Y)for(var n of Y(e))s.indexOf(n)<0&&Qe.call(e,n)&&(t[n]=e[n]);return t};function le(e,s){var t;const n=Math.round(e/s)*s,l=((t=`${s}`.split(".")[1])==null?void 0:t.length)||0;return Number(n.toFixed(l))}const is={size:"sm",getSymbolLabel:e=>`${e}`,count:5,fractions:1,color:"yellow"},cs=ja((e,{size:s,color:t})=>({root:{"--rating-size":ba(s,"rating-size"),"--rating-color":_a(t,e)}})),ue=va((e,s)=>{const t=ga("Rating",is,e),n=t,{classNames:l,className:r,style:o,styles:d,unstyled:c,vars:f,name:j,id:R,value:w,defaultValue:H,onChange:V,fractions:q,count:pe,onMouseEnter:z,readOnly:g,onMouseMove:N,onHover:C,onMouseLeave:A,onTouchStart:B,onTouchEnd:F,size:he,variant:Ge,getSymbolLabel:Je,color:zs,emptySymbol:Ue,fullSymbol:We,highlightSelectedOnly:Xe}=n,Ze=os(n,["classNames","className","style","styles","unstyled","vars","name","id","value","defaultValue","onChange","fractions","count","onMouseEnter","readOnly","onMouseMove","onHover","onMouseLeave","onTouchStart","onTouchEnd","size","variant","getSymbolLabel","color","emptySymbol","fullSymbol","highlightSelectedOnly"]),G=xa({name:"Rating",classes:ze,props:t,className:r,style:o,classNames:l,styles:d,unstyled:c,vars:f,varsResolver:cs}),{dir:ea}=Oe(),aa=be(j),ve=be(R),ge=D.useRef(null),[sa,J]=fa({value:w,defaultValue:H,finalValue:0,onChange:V}),[k,$]=D.useState(-1),[ta,xe]=D.useState(!0),U=Math.floor(q),W=Math.floor(pe),P=1/U,fe=le(sa,P),X=k!==-1?k:fe,ye=i=>{const{left:v,right:b,width:Z}=ge.current.getBoundingClientRect(),ee=Z/W,E=(ea==="rtl"?b-i:i-v)/ee;return Aa(le(E+P/2,P),P,W)},na=i=>{z==null||z(i),!g&&xe(!1)},la=i=>{if(N==null||N(i),g)return;const v=ye(i.clientX);$(v),v!==k&&(C==null||C(v))},ra=i=>{A==null||A(i),!g&&($(-1),xe(!0),k!==-1&&(C==null||C(-1)))},oa=i=>{i.preventDefault();const{touches:v}=i;if(v.length!==1)return;const b=v[0];J(ye(b.clientX)),B==null||B(i)},ia=i=>{i.preventDefault(),F==null||F(i)},ca=()=>ta&&$(-1),da=i=>{g||$(typeof i=="number"?i:parseFloat(i.target.value))},ma=i=>{g||J(typeof i=="number"?i:parseFloat(i.target.value))},ua=Array(W).fill(0).map((i,v)=>{const b=v+1,Z=Array.from(new Array(v===0?U+1:U)),ee=!g&&Math.ceil(k)===b;return u.createElement("div",ne({key:b,"data-active":ee||void 0},G("symbolGroup")),Z.map((pa,E)=>{const je=P*(v===0?E:E+1),M=le(b-1+je,P);return u.createElement(Ke,{key:`${b}-${M}`,size:he,getSymbolLabel:Je,emptyIcon:Ue,fullIcon:We,full:Xe?M===X:M<=X,active:M===X,checked:M===fe,readOnly:g,fractionValue:je,value:M,name:aa,onChange:ma,onBlur:ca,onInputChange:da,id:`${ve}-${v}-${E}`})}))});return u.createElement(Ta,{value:{getStyles:G}},u.createElement(re,ne(rs(ne({ref:ya(ge,s)},G("root")),{onMouseMove:la,onMouseEnter:na,onMouseLeave:ra,onTouchStart:oa,onTouchEnd:ia,variant:Ge,size:he,id:ve}),Ze),ua))});ue.classes=ze;ue.displayName="@mantine/core/Rating";var ds=Q("brand-whatsapp","IconBrandWhatsapp",[["path",{d:"M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9",key:"svg-0"}],["path",{d:"M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1",key:"svg-1"}]]),ms=Q("map-pin","IconMapPin",[["path",{d:"M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-0"}],["path",{d:"M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z",key:"svg-1"}]]),us=Q("message","IconMessage",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z",key:"svg-2"}]]),ps=Q("phone-call","IconPhoneCall",[["path",{d:"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M15 7a2 2 0 0 1 2 2",key:"svg-1"}],["path",{d:"M15 3a6 6 0 0 1 6 6",key:"svg-2"}]]);const He=({files:e})=>{function s(t){try{const r=new URL(t).pathname.split("/"),o=r[r.length-1];return o!==""?o:null}catch{return"unknown file"}}return a.jsx("div",{className:"space-y-1",children:e.map((t,n)=>a.jsxs(O,{to:t,target:"_blank",className:"flex items-center text-sm text-primary-600 line-clamp-1",children:[a.jsx(za,{size:16,className:"flex-shrink-0"}),a.jsx("span",{className:"ml-2",children:s(t)})]},`${t}_${n}`))})};async function hs({data:e}){const s=new FormData;for(const[n,l]of Object.entries(e))l&&(Array.isArray(l)?l.forEach((r,o)=>{l instanceof File?s.append(`${n}[${o}]`,r,r.name):s.append(`${n}[${o}]`,r)}):s.append(n,l.toString()));return(await y.post(e.buying=="internal"?"/ar-service/complain":"/ar-service/complain-external",s)).data}function vs({config:e}={}){return S(hs,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complains"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}async function gs({params:e}){return(await y.get("/ar-service/complain",{params:e})).data.data}function xs({config:e,params:s}={}){return ke({...e,queryKey:["complains",s],queryFn:()=>gs({params:s}),keepPreviousData:!0})}async function fs({id:e}){return(await y.get(`/ar-service/complain/${e}`)).data.data}function ys({config:e,id:s}){return ke({...e,queryKey:["complain",s],queryFn:()=>fs({id:s})})}async function js({id:e}){return(await y.delete(`/ar-service/complain/${e}`)).data}function bs({config:e}={}){return S(js,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complains"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}async function _s({data:e}){const s=new FormData;for(const[n,l]of Object.entries(e))l&&(Array.isArray(l)?l.forEach((r,o)=>{r instanceof File?s.append(`${n}[${o}]`,r,r.name):s.append(`${n}[${o}]`,r)}):s.append(n,l.toString()));return(await y.post("/ar-service/complain/reply",s)).data}function Ss({config:e}={}){return S(_s,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complain"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}async function ws({id:e,data:s}){return(await y.post(`/ar-service/close-complain/${e}`,s)).data}function Ns({config:e}={}){return S(ws,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complains"]),x.invalidateQueries(["complain"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}async function Cs({data:e}){return(await y.post("/ar-service/open-call",e)).data}function Ps({config:e}={}){return S(Cs,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complains"]),x.invalidateQueries(["complain"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}async function Ms({data:e}){return(await y.post("/ar-service/complain-rate",e)).data}function Is({config:e}={}){return S(Ms,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complains"]),x.invalidateQueries(["complain"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}async function Os({data:e}){return(await y.post("/ar-service/complain-visit",{...e,visit_date:ce(e.visit_date).format("YYYY-MM-DD")})).data}function ks({config:e}={}){return S(Os,{...e,onSuccess:(...s)=>{x.invalidateQueries(["complain"]),e!=null&&e.onSuccess&&e.onSuccess(...s)}})}const qe=({status:e,...s})=>{switch(e){case"progress":return a.jsx(ae,{variant:"light",color:"gray",...s,children:"Diproses"});case"close":return a.jsx(ae,{variant:"light",color:"green",...s,children:"Selesai"});case"waiting":return a.jsx(ae,{variant:"light",color:"red",...s,children:"Menunggu"});default:return null}},$s=({toolbar:e,...s})=>{const[t,n]=D.useState({page:1,limit:10,search:""}),{data:l,isLoading:r}=xs({params:{...t,...s}}),o=bs();function d(c){return()=>{m.openConfirmModal({title:"Hapus Komplain",children:a.jsx("div",{className:"text-sm",children:"Apakah anda yakin untuk menghapus komplain ini?"}),centered:!0,onConfirm:async()=>{await o.mutateAsync({id:c},{onSuccess:()=>{h.show({message:"Komplain berhasil dihapus",color:"green",icon:a.jsx(Ea,{})}),m.closeAll()},onError:()=>{h.show({message:"Komplain tidak bisa dihapus",color:"red",icon:a.jsx(Sa,{})}),m.closeAll()}})}})}}return a.jsx(Oa,{title:"Tabel Data Komplain",toolbar:e,header:["#","Judul","Prioritas","Produk","Instansi","Status","Diperbaharui",""],items:l==null?void 0:l.data,onPageChange:c=>{n({...t,page:c})},loading:r,metadata:{count:(l==null?void 0:l.data.length)||10,limit:t.limit||10,page:t.page||10,total:(l==null?void 0:l.total)||10},renderItem:(c,f)=>a.jsxs("tr",{children:[a.jsx("td",{children:(t.limit??5)*((t.page??0)-1)+f+1}),a.jsx("td",{children:c.title}),a.jsx("td",{className:"capitalize",children:c.priority}),a.jsx("td",{children:c.installbase_detail.product.name}),a.jsx("td",{children:c.customer.name}),a.jsx("td",{children:a.jsx(qe,{status:c.status})}),a.jsx("td",{children:ce(c.updated_at).format("D MMMM YYYY H:mm")}),a.jsx("td",{children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(_e,{component:O,to:`/complain/${c.id}`,title:"Detail Komplain",color:"gray",radius:"lg",variant:"subtle",children:a.jsx(ka,{size:16})}),a.jsx(_e,{onClick:d(c.id),title:"Hapus Komplain",color:"red",radius:"lg",variant:"subtle",children:a.jsx($a,{size:16})})]})})]},c.id)})},Es=()=>{const e=$e(),{mutateAsync:s,isLoading:t}=vs(),n=me({initialValues:{title:"",detail:"",filename:[],installbase_id:void 0,placement_space:"",priority:void 0,status:"waiting",buying:"internal",brand_name:void 0,product_name:void 0,serial_number:void 0}}),l=n.onSubmit(async r=>{await s({data:{...r}},{onSuccess:()=>{h.show({color:"green",message:"Komplain berhasil dibuat"}),e("/complain")},onError:({response:o})=>{n.setErrors((o==null?void 0:o.data).errors),h.show({color:"red",message:"Komplain gagal dibuat"})}})});return a.jsxs(_,{component:"form",onSubmit:l,shadow:"lg",children:[a.jsx(_.Section,{p:"lg",withBorder:!0,children:a.jsx("h2",{className:"font-semibold text-base",children:"Tambah Data Komplain"})}),a.jsx(_.Section,{p:"lg",pt:"xs",withBorder:!0,children:a.jsxs("div",{className:"grid grid-cols-12 gap-x-6 gap-y-4",children:[a.jsx(I,{...n.getInputProps("title"),label:"Judul",placeholder:"Masukan Judul",className:"col-span-12 md:col-span-8"}),a.jsx(de,{...n.getInputProps("priority"),label:"Proritas",placeholder:"Pilih Prioritas",data:[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],className:"col-span-12 md:col-span-2"}),a.jsx(I,{...n.getInputProps("placement_space"),label:"Ruang Penempatan",placeholder:"Ex: Radiologi",className:"col-span-12 md:col-span-2"}),a.jsx("div",{className:"col-span-12",children:a.jsx(se.Group,{...n.getInputProps("buying"),label:"Pembelian Produk",children:a.jsxs(wa,{mt:"xs",children:[a.jsx(se,{value:"internal",label:"Di Kami"}),a.jsx(se,{value:"external",label:"Di Tempat Lain"})]})})}),n.values.buying=="internal"?a.jsx(La,{...n.getInputProps("installbase_id"),label:"Produk",placeholder:"Pilih Produk",className:"col-span-12 md:col-span-12",nothingFoundMessage:"Data tidak ditemukan"}):a.jsxs(a.Fragment,{children:[a.jsx(I,{...n.getInputProps("brand_name"),label:"Brand",placeholder:"Masukan Nama Brand",className:"col-span-12 lg:col-span-4"}),a.jsx(I,{...n.getInputProps("product_name"),label:"Produk",placeholder:"Masukan Nama Product",className:"col-span-12 lg:col-span-4"}),a.jsx(I,{...n.getInputProps("serial_number"),label:"Serial Number",placeholder:"Masukan Serial Number",className:"col-span-12 lg:col-span-4"})]}),a.jsx("div",{className:"col-span-12",children:a.jsx(De,{label:"Detail",value:n.values.detail||"",onChange:r=>n.setFieldValue("detail",r)})}),a.jsx("div",{className:"col-span-12",children:a.jsx(Re,{value:n.values.filename,onDrop:r=>n.setFieldValue("filename",r),label:"Foto/Video Pendukung",maxFiles:5,maxSize:5*1024**2})})]})}),a.jsxs(_.Section,{p:"lg",withBorder:!0,className:"flex items-center space-x-4",children:[a.jsx(p,{type:"submit",loading:t,children:"Simpan"}),a.jsx(p,{component:O,to:"/complain",variant:"light",color:"gray.6",bg:"gray.2",children:"Batal"})]})]})},Ds=({replies:e})=>{const{creds:s}=Ee(),t=Is();async function n(l,r){await t.mutateAsync({data:{complain_reply_id:l,rate:r}},{onSuccess:()=>h.show({message:"Terima kasih atas feedback Anda",color:"green"}),onError:()=>h.show({message:"Gagal menambah rating",color:"red"})})}return e.length==0?a.jsx("div",{className:"text-gray-600",children:"Belum ada balasan"}):a.jsx("div",{className:"space-y-4",children:e.map(l=>a.jsxs("div",{className:"border border-gray-300 rounded-md",children:[a.jsx("div",{className:"p-4 border-b border-gray-300 flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 bg-gray-200 text-gray-600 rounded-full",children:a.jsx(Na,{size:24})}),a.jsxs("div",{children:[a.jsx("div",{className:"font-semibold text-sm",children:l.user.profile.name}),a.jsx("div",{className:"text-xs text-gray-600",children:Ca(l.created_at).format("D MMMM YYYY HH:mm")})]})]})}),a.jsxs("div",{className:"p-4",children:[a.jsx("div",{className:"prose prose-sm mb-2",dangerouslySetInnerHTML:{__html:l.detail}}),a.jsx(He,{files:l.complain_files.map(({filename:r})=>r)}),l.user.roles.map(({name:r})=>r).includes("Engineer")&&a.jsx("div",{className:"mt-3",children:a.jsx(ue,{value:l.rate,readOnly:(s==null?void 0:s.role)!="Customer",onChange:r=>{t.isLoading||n(l.id,r)}})})]})]},l.id))})},Rs=({complain:e,onCancel:s,onSuccess:t})=>{const n=Ss(),l=me({initialValues:{complain_id:e,detail:"",filename:[]}}),r=l.onSubmit(async o=>{await n.mutateAsync({data:o},{onSuccess:()=>{h.show({color:"green",message:"Balasan berhasil dibuat"}),t&&t()},onError:({response:d})=>{l.setErrors((d==null?void 0:d.data).errors),h.show({color:"red",message:"Balasan gagal dibuat"})}})});return a.jsxs("form",{onSubmit:r,children:[a.jsxs("div",{className:"grid grid-cols-12 gap-x-6 gap-y-4",children:[a.jsxs("div",{className:"col-span-12",children:[a.jsx(De,{label:"Pesan",value:l.values.detail,onChange:o=>l.setFieldValue("detail",o)}),l.errors.detail&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.errors.detail})]}),a.jsxs("div",{className:"col-span-12",children:[a.jsx(Re,{value:l.values.filename,onDrop:o=>l.setFieldValue("filename",o),label:"Foto/Video Pendukung",maxFiles:5,maxSize:5*1024**2}),l.errors.filename&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.errors.filename})]})]}),a.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[a.jsx(p,{type:"submit",loading:n.isLoading,children:"Simpan"}),a.jsx(p,{variant:"light",color:"gray.6",bg:"gray.2",onClick:s,loading:n.isLoading,children:"Batal"})]})]})},Vs=({complain:e,onCancel:s,onSuccess:t})=>{const n=ks(),l=me({initialValues:{complain_id:e,visit_date:void 0,visit_type:void 0}}),r=l.onSubmit(async o=>{await n.mutateAsync({data:o},{onSuccess:()=>{h.show({color:"green",message:"Balasan berhasil dibuat"}),t&&t()},onError:({response:d})=>{l.setErrors((d==null?void 0:d.data).errors),h.show({color:"red",message:"Balasan gagal dibuat"})}})});return a.jsxs("form",{onSubmit:r,children:[a.jsxs("div",{className:"grid grid-cols-12 gap-x-6 gap-y-4",children:[a.jsx(Ba,{...l.getInputProps("visit_date"),label:"Tanggal Rencana Kunjungan",placeholder:"Pilih Tanggal",className:"col-span-12",valueFormat:"D MMMM YYYY"}),a.jsx(de,{...l.getInputProps("visit_type"),label:"Jenis Kunjungan",placeholder:"Pilih Jenis Kunjungan",data:["Customer Visit","Corective Maintenance","Preventive Maintenance"],className:"col-span-12"})]}),a.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[a.jsx(p,{type:"submit",loading:n.isLoading,children:"Simpan"}),a.jsx(p,{variant:"light",color:"gray.6",bg:"gray.2",onClick:s,loading:n.isLoading,children:"Batal"})]})]})},ot=()=>{var n,l;const[e,s]=D.useState({search:"",status:void 0,customer_id:void 0}),[t]=Da(e,200);return a.jsxs("main",{children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[a.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Data Komplain"}),a.jsx(oe,{role:["Customer"],children:a.jsx(p,{component:O,to:"/complain/create",children:"Tambah"})})]}),a.jsx("section",{className:"space-y-4 mb-4",children:a.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[a.jsx("div",{className:"col-span-12 md:col-span-6 lg:col-span-3",children:a.jsx(I,{leftSection:a.jsx(Va,{size:16}),placeholder:"Cari berdasarkan judul",value:e.search,onChange:r=>s({...e,search:r.target.value})})}),a.jsx("div",{className:"col-span-6 md:col-span-3 lg:col-span-2",children:a.jsx(de,{leftSection:a.jsx(Se,{size:16}),placeholder:"Pilih Status",data:[{label:"Selesai",value:"close"},{label:"Diproses",value:"progress"},{label:"Menunggu",value:"waiting"}],value:((n=e.status)==null?void 0:n.toString())??null,onChange:r=>{s({...e,status:r||void 0})}})}),a.jsx(oe,{role:["-Customer"],children:a.jsx("div",{className:"col-span-6 md:col-span-3 lg:col-span-2",children:a.jsx(Ia,{leftSection:a.jsx(Se,{size:16}),placeholder:"Pilih Instansi",value:((l=e.customer_id)==null?void 0:l.toString())??null,onChange:r=>{s({...e,customer_id:r||void 0})}})})})]})}),a.jsx("section",{className:"mb-8",children:a.jsx($s,{...t})})]})},it=()=>{const{id:e}=Pa(),s=$e(),t=Ns(),n=Ps(),{creds:l}=Ee(),{data:r,isLoading:o,isError:d}=ys({id:e});function c(){r&&m.open({modalId:"complain-reply",title:"Balas Komplain",size:"xl",children:a.jsx(Rs,{complain:r.id,onCancel:()=>m.close("complain-reply"),onSuccess:()=>m.close("complain-reply")})})}function f(){r&&m.open({modalId:"complain-visit",title:"Form Rencana Kunjungan",size:"xl",children:a.jsx(Vs,{complain:r.id,onCancel:()=>m.close("complain-visit"),onSuccess:()=>m.close("complain-visit")})})}function j(){m.openConfirmModal({title:"Open Call",children:a.jsx("div",{className:"text-sm",children:"Apakah anda yakin untuk 'open call' untuk komplain ini?"}),centered:!0,onConfirm:async()=>{await n.mutateAsync({data:{id:(r==null?void 0:r.id)||"",is_open_call:"true"}},{onSuccess:()=>{h.show({message:"Call berhasil dibuka",color:"green"}),m.closeAll()},onError:()=>{h.show({message:"Call gagal dibuka",color:"red"}),m.closeAll()}})}})}function R(){m.openConfirmModal({title:"Tutup Komplain",children:a.jsx("div",{className:"text-sm",children:"Apakah anda yakin untuk menutup komplain ini?"}),centered:!0,onConfirm:async()=>{await t.mutateAsync({id:r.id,data:{status:"close"}},{onSuccess:()=>{h.show({message:"Komplain berhasil ditutup",color:"green"}),m.closeAll()},onError:()=>{h.show({message:"Komplain gagal dihapus",color:"red"}),m.closeAll()}})}})}return o?a.jsx("div",{className:"mt-48",children:a.jsx(Ra,{})}):d?a.jsxs("div",{className:"mt-48 text-center",children:[a.jsx("h1",{className:"text-lg font-bold mb-2",children:"Data komplain tidak ditemukan"}),a.jsx(p,{onClick:()=>s(-1),leftSection:a.jsx(Fa,{size:14}),children:"Kembali"})]}):a.jsxs("main",{children:[a.jsx("div",{className:"mb-4 flex items-center justify-between",children:a.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Detail Komplain"})}),a.jsxs(_,{children:[a.jsxs(_.Section,{px:"lg",py:"md",withBorder:!0,children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between space-y-3 border-b border-gray-300 pb-4",children:[a.jsxs("div",{className:"flex-grow",children:[a.jsx(qe,{status:r.status,radius:"sm"}),a.jsxs("h1",{className:"font-bold text-xl text-gray-800 mt-1 mb-1",children:[r.title," #",r.id]}),a.jsxs("p",{className:"text-xs text-gray-600",children:["Dibuka oleh ",a.jsx("span",{className:"font-bold",children:r.customer.name})," pada"," ",ce(r.created_at).fromNow(),"."]})]}),a.jsxs("div",{className:"text-sm md:text-base",children:["Priority:"," ",a.jsx("span",{className:Ma("capitalize",r.priority=="high"?"text-red-600":r.priority=="medium"?"text-primary-600":"text-green-600"),children:r.priority})]})]}),a.jsxs("div",{className:"pt-4",children:[a.jsx("div",{className:"prose prose-sm mb-4",dangerouslySetInnerHTML:{__html:r.detail}}),a.jsx(He,{files:r.complain_files.map(({filename:w})=>w)})]}),a.jsxs("section",{className:"mt-6",children:[a.jsx("div",{className:"mb-2",children:a.jsx("h3",{className:"text-base font-bold",children:"Balasan"})}),a.jsx(Ds,{replies:r.complain_reply}),a.jsx("div",{className:"flex justify-end mt-4"})]})]}),a.jsx(_.Section,{p:"lg",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(oe,{role:["Engineer"],children:a.jsx(p,{onClick:f,leftSection:a.jsx(ms,{size:16}),color:"yellow",children:"Visit"})}),a.jsx(p,{onClick:c,leftSection:a.jsx(us,{size:16}),children:"Reply"}),!r.user_engineer&&(l==null?void 0:l.role)!="Customer"&&a.jsx(p,{onClick:j,color:"teal",leftSection:a.jsx(ps,{size:16}),children:"Open Call"}),r.user_engineer&&(l==null?void 0:l.role)=="Customer"&&a.jsx(p,{component:O,to:`https://wa.me/${r.user_engineer.profile.phone}`,target:"_blank",color:"green",leftSection:a.jsx(ds,{size:16}),children:"Hubungi Teknisi"}),r.status!="close"&&a.jsx(p,{color:"red",onClick:R,children:"Close"}),a.jsx(p,{component:O,to:"/complain",variant:"light",color:"gray.6",bg:"gray.2",children:"Kembali"})]})})]})]})},ct=()=>a.jsxs("main",{children:[a.jsx("div",{className:"mb-4 flex items-center justify-between",children:a.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Data Komplain"})}),a.jsx(Es,{})]});export{ct as ComplainCreate,it as ComplainDetail,ot as Complains};

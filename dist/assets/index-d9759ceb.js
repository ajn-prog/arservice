import{c as f,j as e,L as j,u as g,q as h,a as x,e as S,P as y,r as k,i as w,f as N,t as c,n as m,I as B,p as I,B as d,Q as $,S as E,b as L,v as T,d as R,h as Q}from"./index-ab786f8a.js";import{A as H}from"./AgencySelect-bcd0f2a4.js";import{T as V}from"./Table-4bba3648.js";import{I as Y}from"./IconEye-d32ec62c.js";import{I as q,a as O,u as J,L as U}from"./LoadingScreen-9b6af06e.js";import{T as M}from"./TextEditor-bfc49ac0.js";import{T as b}from"./TextInput-04173e2e.js";import{I as W}from"./IconSearch-16141f78.js";import{C as p,S as P}from"./Select-9282afee.js";import{I as C}from"./IconCategory-7f73a8ff.js";import{I as X,a as G}from"./ItemSelect-b6fd274b.js";import{F as _}from"./FileDropzone-e6c55f0d.js";import{u as D}from"./use-form-361df6b2.js";import{I as Z}from"./IconArrowLeft-5623df08.js";import"./get-base-value-c9c274d2.js";import"./ScrollArea-5859cb9a.js";import"./LoadingOverlay-61d90ea2.js";import"./IconPhoto-a9b2e27b.js";var ee=f("brand-whatsapp","IconBrandWhatsapp",[["path",{d:"M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9",key:"svg-0"}],["path",{d:"M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1",key:"svg-1"}]]),ae=f("message","IconMessage",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z",key:"svg-2"}]]),se=f("phone-call","IconPhoneCall",[["path",{d:"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M15 7a2 2 0 0 1 2 2",key:"svg-1"}],["path",{d:"M15 3a6 6 0 0 1 6 6",key:"svg-2"}]]);const A=({files:a})=>{function s(i){try{const l=new URL(i).pathname.split("/"),r=l[l.length-1];return r!==""?r:null}catch{return"unknown file"}}return e.jsx("div",{className:"space-y-1",children:a.map((i,n)=>e.jsxs(j,{to:i,target:"_blank",className:"flex items-center text-sm text-primary-600 line-clamp-1",children:[e.jsx(X,{size:16,className:"flex-shrink-0"}),e.jsx("span",{className:"ml-2",children:s(i)})]},`${i}_${n}`))})};async function le({data:a}){const s=new FormData;for(const[n,t]of Object.entries(a))t&&(Array.isArray(t)?t.forEach((l,r)=>{t instanceof File?s.append(`${n}[${r}]`,l,l.name):s.append(`${n}[${r}]`,l)}):s.append(n,t.toString()));return(await x.post("/ar-service/complain",s)).data}function te({config:a}={}){return g(le,{...a,onSuccess:(...s)=>{h.invalidateQueries(["complains"]),a!=null&&a.onSuccess&&a.onSuccess(...s)}})}async function ne({params:a}){return(await x.get("/ar-service/complain",{params:a})).data.data}function ie({config:a,params:s}={}){return S({...a,queryKey:["complains",s],queryFn:()=>ne({params:s}),keepPreviousData:!0})}async function re({id:a}){return(await x.get(`/ar-service/complain/${a}`)).data.data}function oe({config:a,id:s}){return S({...a,queryKey:["complain",s],queryFn:()=>re({id:s})})}async function ce({id:a}){return(await x.delete(`/ar-service/complain/${a}`)).data}function de({config:a}={}){return g(ce,{...a,onSuccess:(...s)=>{h.invalidateQueries(["complains"]),a!=null&&a.onSuccess&&a.onSuccess(...s)}})}async function me({data:a}){const s=new FormData;for(const[n,t]of Object.entries(a))t&&(Array.isArray(t)?t.forEach((l,r)=>{t instanceof File?s.append(`${n}[${r}]`,l,l.name):s.append(`${n}[${r}]`,l)}):s.append(n,t.toString()));return(await x.post("/ar-service/complain/reply",s)).data}function ue({config:a}={}){return g(me,{...a,onSuccess:(...s)=>{h.invalidateQueries(["complain"]),a!=null&&a.onSuccess&&a.onSuccess(...s)}})}async function pe({id:a,data:s}){return(await x.post(`/ar-service/close-complain/${a}`,s)).data}function he({config:a}={}){return g(pe,{...a,onSuccess:(...s)=>{h.invalidateQueries(["complains"]),h.invalidateQueries(["complain"]),a!=null&&a.onSuccess&&a.onSuccess(...s)}})}async function xe({data:a}){return(await x.post("/ar-service/open-call",a)).data}function je({config:a}={}){return g(xe,{...a,onSuccess:(...s)=>{h.invalidateQueries(["complains"]),h.invalidateQueries(["complain"]),a!=null&&a.onSuccess&&a.onSuccess(...s)}})}const F=({status:a,...s})=>{switch(a){case"progress":return e.jsx(y,{variant:"light",color:"gray",...s,children:"Diproses"});case"close":return e.jsx(y,{variant:"light",color:"green",...s,children:"Selesai"});case"waiting":return e.jsx(y,{variant:"light",color:"red",...s,children:"Menunggu"});default:return null}},ge=({toolbar:a,...s})=>{const[i,n]=k.useState({page:1,limit:10,search:""}),{data:t,isLoading:l}=ie({params:{...i,...s}}),r=de();function u(o){return()=>{c.openConfirmModal({title:"Hapus Komplain",children:e.jsx("div",{className:"text-sm",children:"Apakah anda yakin untuk menghapus komplain ini?"}),centered:!0,onConfirm:async()=>{await r.mutateAsync({id:o},{onSuccess:()=>{m.show({message:"Komplain berhasil dihapus",color:"green",icon:e.jsx(O,{})}),c.closeAll()},onError:()=>{m.show({message:"Komplain tidak bisa dihapus",color:"red",icon:e.jsx(B,{})}),c.closeAll()}})}})}}return e.jsx(V,{title:"Tabel Data Komplain",toolbar:a,header:["#","Judul","Prioritas","Produk","Instansi","Status","Diperbaharui",""],items:t==null?void 0:t.data,onPageChange:o=>{n({...i,page:o})},loading:l,metadata:{count:(t==null?void 0:t.data.length)||10,limit:i.limit||10,page:i.page||10,total:(t==null?void 0:t.total)||10},renderItem:(o,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:(i.limit??5)*((i.page??0)-1)+v+1}),e.jsx("td",{children:o.title}),e.jsx("td",{className:"capitalize",children:o.priority}),e.jsx("td",{children:o.installbase_detail.product.name}),e.jsx("td",{children:o.customer.name}),e.jsx("td",{children:e.jsx(F,{status:o.status})}),e.jsx("td",{children:w(o.updated_at).format("D MMMM YYYY H:mm")}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{component:j,to:`/complain/${o.id}`,title:"Detail Komplain",color:"gray",radius:"lg",variant:"subtle",children:e.jsx(Y,{size:16})}),e.jsx(N,{onClick:u(o.id),title:"Hapus Komplain",color:"red",radius:"lg",variant:"subtle",children:e.jsx(q,{size:16})})]})})]},o.id)})},ve=()=>{const a=I(),{mutateAsync:s,isLoading:i}=te(),n=D({initialValues:{title:"",detail:"",filename:[],installbase_id:void 0,placement_space:"",priority:void 0,status:"waiting"}}),t=n.onSubmit(async l=>{console.log(l),await s({data:{...l}},{onSuccess:()=>{m.show({color:"green",message:"Komplain berhasil dibuat"}),a("/complain")},onError:({response:r})=>{n.setErrors((r==null?void 0:r.data).errors),m.show({color:"red",message:"Komplain gagal dibuat"})}})});return e.jsxs(p,{component:"form",onSubmit:t,shadow:"lg",children:[e.jsx(p.Section,{p:"lg",withBorder:!0,children:e.jsx("h2",{className:"font-semibold text-base",children:"Tambah Data Komplain"})}),e.jsx(p.Section,{p:"lg",pt:"xs",withBorder:!0,children:e.jsxs("div",{className:"grid grid-cols-12 gap-x-6 gap-y-4",children:[e.jsx(b,{...n.getInputProps("title"),label:"Judul",placeholder:"Masukan Judul",className:"col-span-12 md:col-span-8"}),e.jsx(P,{...n.getInputProps("priority"),label:"Proritas",placeholder:"Pilih Prioritas",data:[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"}],className:"col-span-12 md:col-span-2"}),e.jsx(b,{...n.getInputProps("placement_space"),label:"Ruang Penempatan",placeholder:"Ex: Radiologi",className:"col-span-12 md:col-span-2"}),e.jsx(G,{...n.getInputProps("installbase_id"),label:"Produk",placeholder:"Pilih Produk",className:"col-span-12 md:col-span-12",nothingFoundMessage:"Data tidak ditemukan"}),e.jsx("div",{className:"col-span-12",children:e.jsx(M,{label:"Detail",value:n.values.detail,onChange:l=>n.setFieldValue("detail",l)})}),e.jsx("div",{className:"col-span-12",children:e.jsx(_,{value:n.values.filename,onDrop:l=>n.setFieldValue("filename",l),label:"Foto/Video Pendukung",maxFiles:5,maxSize:5*1024**2})})]})}),e.jsxs(p.Section,{p:"lg",withBorder:!0,className:"flex items-center space-x-4",children:[e.jsx(d,{type:"submit",loading:i,children:"Simpan"}),e.jsx(d,{component:j,to:"/complain",variant:"light",color:"gray.6",bg:"gray.2",children:"Batal"})]})]})},ye=({replies:a})=>a.length==0?e.jsx("div",{className:"text-gray-600",children:"Belum ada balasan"}):e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsxs("div",{className:"border border-gray-300 rounded-md",children:[e.jsx("div",{className:"p-4 border-b border-gray-300 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-gray-200 text-gray-600 rounded-full",children:e.jsx($,{size:24})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm",children:s.user.profile.name}),e.jsx("div",{className:"text-xs text-gray-600",children:E(s.created_at).format("D MMMM YYYY HH:mm")})]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"prose prose-sm mb-4",dangerouslySetInnerHTML:{__html:s.detail}}),e.jsx(A,{files:s.complain_files.map(({filename:i})=>i)})]})]},s.id))}),be=({complain:a,onCancel:s,onSuccess:i})=>{const n=ue(),t=D({initialValues:{complain_id:a,detail:"",filename:[]}}),l=t.onSubmit(async r=>{await n.mutateAsync({data:r},{onSuccess:()=>{m.show({color:"green",message:"Balasan berhasil dibuat"}),i&&i()},onError:({response:u})=>{t.setErrors((u==null?void 0:u.data).errors),m.show({color:"red",message:"Balasan gagal dibuat"})}})});return e.jsxs("form",{onSubmit:l,children:[e.jsxs("div",{className:"grid grid-cols-12 gap-x-6 gap-y-4",children:[e.jsx("div",{className:"col-span-12",children:e.jsx(M,{label:"Pesan",value:t.values.detail,onChange:r=>t.setFieldValue("detail",r)})}),e.jsx("div",{className:"col-span-12",children:e.jsx(_,{value:t.values.filename,onDrop:r=>t.setFieldValue("filename",r),label:"Foto/Video Pendukung",maxFiles:5,maxSize:5*1024**2})})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[e.jsx(d,{type:"submit",loading:n.isLoading,children:"Simpan"}),e.jsx(d,{variant:"light",color:"gray.6",bg:"gray.2",onClick:s,loading:n.isLoading,children:"Batal"})]})]})},Le=()=>{var n,t;const[a,s]=k.useState({search:"",status:void 0,customer_id:void 0}),[i]=J(a,200);return e.jsxs("main",{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Data Komplain"}),e.jsx(d,{component:j,to:"/complain/create",children:"Tambah"})]}),e.jsx("section",{className:"space-y-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-6 lg:col-span-3",children:e.jsx(b,{leftSection:e.jsx(W,{size:16}),placeholder:"Cari berdasarkan judul",value:a.search,onChange:l=>s({...a,search:l.target.value})})}),e.jsx("div",{className:"col-span-6 md:col-span-3 lg:col-span-2",children:e.jsx(P,{leftSection:e.jsx(C,{size:16}),placeholder:"Pilih Status",data:[{label:"Selesai",value:"close"},{label:"Diproses",value:"progress"},{label:"Menunggu",value:"waiting"}],value:((n=a.status)==null?void 0:n.toString())??null,onChange:l=>{s({...a,status:l||void 0})}})}),e.jsx(L,{role:["-Customer"],children:e.jsx("div",{className:"col-span-6 md:col-span-3 lg:col-span-2",children:e.jsx(H,{leftSection:e.jsx(C,{size:16}),placeholder:"Pilih Instansi",value:((t=a.customer_id)==null?void 0:t.toString())??null,onChange:l=>{s({...a,customer_id:l||void 0})}})})})]})}),e.jsx("section",{className:"mb-8",children:e.jsx(ge,{...i})})]})},Te=()=>{const{id:a}=T(),s=I(),i=he(),n=je(),{creds:t}=R(),{data:l,isLoading:r,isError:u}=oe({id:a});function o(){l&&c.open({modalId:"complain-reply",title:"Balas Komplain",size:"xl",children:e.jsx(be,{complain:l.id,onCancel:()=>c.close("complain-reply"),onSuccess:()=>c.close("complain-reply")})})}function v(){c.openConfirmModal({title:"Open Call",children:e.jsx("div",{className:"text-sm",children:"Apakah anda yakin untuk 'open call' untuk komplain ini?"}),centered:!0,onConfirm:async()=>{await n.mutateAsync({data:{id:(l==null?void 0:l.id)||"",is_open_call:"true"}},{onSuccess:()=>{m.show({message:"Call berhasil dibuka",color:"green"}),c.closeAll()},onError:()=>{m.show({message:"Call gagal dibuka",color:"red"}),c.closeAll()}})}})}function K(){c.openConfirmModal({title:"Tutup Komplain",children:e.jsx("div",{className:"text-sm",children:"Apakah anda yakin untuk menutup komplain ini?"}),centered:!0,onConfirm:async()=>{await i.mutateAsync({id:l.id,data:{status:"close"}},{onSuccess:()=>{m.show({message:"Komplain berhasil ditutup",color:"green"}),c.closeAll()},onError:()=>{m.show({message:"Komplain gagal dihapus",color:"red"}),c.closeAll()}})}})}return r?e.jsx("div",{className:"mt-48",children:e.jsx(U,{})}):u?e.jsxs("div",{className:"mt-48 text-center",children:[e.jsx("h1",{className:"text-lg font-bold mb-2",children:"Data komplain tidak ditemukan"}),e.jsx(d,{onClick:()=>s(-1),leftSection:e.jsx(Z,{size:14}),children:"Kembali"})]}):e.jsxs("main",{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Detail Komplain"})}),e.jsxs(p,{children:[e.jsxs(p.Section,{px:"lg",py:"md",withBorder:!0,children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between space-y-3 border-b border-gray-300 pb-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx(F,{status:l.status,radius:"sm"}),e.jsxs("h1",{className:"font-bold text-xl text-gray-800 mt-1 mb-1",children:[l.title," #",l.id]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Dibuka oleh ",e.jsx("span",{className:"font-bold",children:l.customer.name})," pada"," ",w(l.created_at).fromNow(),"."]})]}),e.jsxs("div",{className:"text-sm md:text-base",children:["Priority:"," ",e.jsx("span",{className:Q("capitalize",l.priority=="high"?"text-red-600":l.priority=="medium"?"text-primary-600":"text-green-600"),children:l.priority})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"prose prose-sm mb-4",dangerouslySetInnerHTML:{__html:l.detail}}),e.jsx(A,{files:l.complain_files.map(({filename:z})=>z)})]}),e.jsxs("section",{className:"mt-6",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h3",{className:"text-base font-bold",children:"Balasan"})}),e.jsx(ye,{replies:l.complain_reply}),e.jsx("div",{className:"flex justify-end mt-4"})]})]}),e.jsx(p.Section,{p:"lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{onClick:o,leftSection:e.jsx(ae,{size:16}),children:"Reply"}),!l.user_engineer&&(t==null?void 0:t.role)!="Customer"&&e.jsx(d,{onClick:v,color:"teal",leftSection:e.jsx(se,{size:16}),children:"Open Call"}),l.user_engineer&&(t==null?void 0:t.role)=="Customer"&&e.jsx(d,{component:j,to:`https://wa.me/${l.user_engineer.profile.phone}`,target:"_blank",color:"green",leftSection:e.jsx(ee,{size:16}),children:"Hubungi Teknisi"}),l.status!="close"&&e.jsx(d,{color:"red",onClick:K,children:"Close"}),e.jsx(d,{component:j,to:"/complain",variant:"light",color:"gray.6",bg:"gray.2",children:"Kembali"})]})})]})]})},Re=()=>e.jsxs("main",{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Data Komplain"})}),e.jsx(ve,{})]});export{Re as ComplainCreate,Te as ComplainDetail,Le as Complains};
